## Системные тесты. Тесты на API

**Сквозные тесты или e2e** - тип тестов, при котором бизнес-процессы проверяются от начала до конца в условиях, аналогичных боевым.

**Системные тесты** -- проверяют сковзные сценарии и фокусируются на проверке соответствия определенным требованиям системы в целом.

- Проверяют сквозные сценарии пользователей (e2e)
- Проводятся на системе, близкой к боевой
- Проводятся на различных окружениях: браузеры, ОС, устройства

**Системные тесты на собственный API**

- Покрывают сквозные сценарии
- Используют методы, доступные пользователю
- Проверяют как положительные, так и негативные сценарии
- Проверяют соответствии кодов ответов, тексты ошибок
- Проверяют возвращаемые данные

Тест на контроллер [BooksApi](jetbrains://rd/navigate/reference?project=Kontur.BigLibrary&path=Kontur.BigLibrary.Service/ClientApp/src/api/BookApi.ts) 

В класс [BooksApi](jetbrains://rd/navigate/reference?project=Kontur.BigLibrary&path=Kontur.BigLibrary.Tests.ApiSystem/BooksApi.cs) вынесено формирование запросов.

### Подготовка

#### 1. Локальный запуск
Тесты запускаются против локально запущенной системы  

#### 3. Клиент для API
В классе `BooksApiClient` используется RestSharp для обозначения клиента. Для клиента указан тот же URL, на котором локально запускается сервис `http://localhost:5000/`.
`BooksApiClient` использует непосредственно API библиотеки, в котором описаны методы.

#### 4. Методы для подготовки данных
Для создания книги через запрос `AddBookToLibrary` нужен токен авторизации и данные о книге.
Для того чтоб получить токен, необходимо зарегестировать пользователя.
Используем метод `RegisterUser` из `AuthApiClient` , который возвращает token.

### Тест

Тест на сценарий добавления книги без данных

1. Регестируем пользователя и получаем авторицационны токен методом `RegisterUser()` 
2. Создаем пустой объект `Book` 
4. Отправляем запрос `AddBookToLibrary()` и сорхраняем ответ в переменную
5. Проверяем, что код ответа `HttpStatusCode.BadReqest`
6. Проверям, что в ответе сообщение об ошибке "Не заполнены обязательные поля"


### Домашнее задание
Напишите тесты на API, которые будут покрывать сценарии:
1) Встать в очередь когда
    - книга свободна
    - книга занята другим пользователем
    - текущий пользователь уже есть в очереди
    - книга занята текущим пользователем
2) Взять книгу
    - книга свободна, очереди нет
    - книга занята другим пользователем
    - книга свободна, первый в очереди другой пользователь
    - книга освободилась, текущий пользователь первый в очереди
